import{r as P,R as ce}from"./vendor.DebuA49u.js";const L={},X=(e,n)=>e.unstable_is?e.unstable_is(n):n===e,Y=e=>"init"in e,C=e=>!!e.write,Z=e=>"v"in e||"e"in e,x=e=>{if("e"in e)throw e.e;if((L?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},j=new WeakMap,k=e=>{var n;return M(e)&&!!((n=j.get(e))!=null&&n[0])},le=e=>{const n=j.get(e);n!=null&&n[0]&&(n[0]=!1,n[1].forEach(t=>t()))},m=(e,n)=>{let t=j.get(e);if(!t){t=[!0,new Set],j.set(e,t);const c=()=>{t[0]=!1};e.then(c,c)}t[1].add(n)},M=e=>typeof(e==null?void 0:e.then)=="function",ee=(e,n,t)=>{t.p.has(e)||(t.p.add(e),n.then(()=>{t.p.delete(e)},()=>{t.p.delete(e)}))},G=(e,n,t)=>{const c=t(e),v="v"in c,d=c.v;if(M(n))for(const f of c.d.keys())ee(e,n,t(f));c.v=n,delete c.e,(!v||!Object.is(d,c.v))&&(++c.n,M(d)&&le(d))},B=(e,n,t)=>{var c;const v=new Set;for(const d of((c=t.get(e))==null?void 0:c.t)||[])t.has(d)&&v.add(d);for(const d of n.p)v.add(d);return v},ue=()=>{const e=new Set,n=()=>{e.forEach(t=>t())};return n.add=t=>(e.add(t),()=>{e.delete(t)}),n},K=()=>{const e={},n=new WeakMap,t=c=>{var v,d;(v=n.get(e))==null||v.forEach(f=>f(c)),(d=n.get(c))==null||d.forEach(f=>f())};return t.add=(c,v)=>{const d=c||e,f=(n.has(d)?n:n.set(d,new Set)).get(d);return f.add(v),()=>{f==null||f.delete(v),f.size||n.delete(d)}},t},de=e=>(e.c||(e.c=K()),e.m||(e.m=K()),e.u||(e.u=K()),e.f||(e.f=ue()),e),fe=Symbol(),ae=(e=new WeakMap,n=new WeakMap,t=new WeakMap,c=new Set,v=new Set,d=new Set,f={},_=(h,...y)=>h.read(...y),p=(h,...y)=>h.write(...y),a=(h,y)=>{var E;return(E=h.unstable_onInit)==null?void 0:E.call(h,y)},b=(h,y)=>{var E;return(E=h.onMount)==null?void 0:E.call(h,y)},...A)=>{const h=A[0]||(r=>{if((L?"production":void 0)!=="production"&&!r)throw new Error("Atom is undefined or null");let u=e.get(r);return u||(u={d:new Map,p:new Set,n:0},e.set(r,u),a==null||a(r,J)),u}),y=A[1]||(()=>{const r=[],u=l=>{try{l()}catch(i){r.push(i)}};do{f.f&&u(f.f);const l=new Set,i=l.add.bind(l);c.forEach(o=>{var s;return(s=n.get(o))==null?void 0:s.l.forEach(i)}),c.clear(),d.forEach(i),d.clear(),v.forEach(i),v.clear(),l.forEach(u),c.size&&E()}while(c.size||d.size||v.size);if(r.length)throw new AggregateError(r)}),E=A[2]||(()=>{const r=[],u=new WeakSet,l=new WeakSet,i=Array.from(c);for(;i.length;){const o=i[i.length-1],s=h(o);if(l.has(o)){i.pop();continue}if(u.has(o)){if(t.get(o)===s.n)r.push([o,s]);else if((L?"production":void 0)!=="production"&&t.has(o))throw new Error("[Bug] invalidated atom exists");l.add(o),i.pop();continue}u.add(o);for(const S of B(o,s,n))u.has(S)||i.push(S)}for(let o=r.length-1;o>=0;--o){const[s,S]=r[o];let g=!1;for(const T of S.d.keys())if(T!==s&&c.has(T)){g=!0;break}g&&(R(s),W(s)),t.delete(s)}}),R=A[3]||(r=>{var u;const l=h(r);if(Z(l)&&(n.has(r)&&t.get(r)!==l.n||Array.from(l.d).every(([w,V])=>R(w).n===V)))return l;l.d.clear();let i=!0;const o=()=>{n.has(r)&&(W(r),E(),y())},s=w=>{var V;if(X(r,w)){const Q=h(w);if(!Z(Q))if(Y(w))G(w,w.init,h);else throw new Error("no atom init");return x(Q)}const $=R(w);try{return x($)}finally{l.d.set(w,$.n),k(l.v)&&ee(r,l.v,$),(V=n.get(w))==null||V.t.add(r),i||o()}};let S,g;const T={get signal(){return S||(S=new AbortController),S.signal},get setSelf(){return(L?"production":void 0)!=="production"&&!C(r)&&console.warn("setSelf function cannot be used with read-only atom"),!g&&C(r)&&(g=(...w)=>{if((L?"production":void 0)!=="production"&&i&&console.warn("setSelf function cannot be called in sync"),!i)try{return D(r,...w)}finally{E(),y()}}),g}},N=l.n;try{const w=_(r,s,T);return G(r,w,h),M(w)&&(m(w,()=>S==null?void 0:S.abort()),w.then(o,o)),l}catch(w){return delete l.v,l.e=w,++l.n,l}finally{i=!1,N!==l.n&&t.get(r)===N&&(t.set(r,l.n),c.add(r),(u=f.c)==null||u.call(f,r))}}),U=A[4]||(r=>{const u=[r];for(;u.length;){const l=u.pop(),i=h(l);for(const o of B(l,i,n)){const s=h(o);t.set(o,s.n),u.push(o)}}}),D=A[5]||((r,...u)=>{let l=!0;const i=s=>x(R(s)),o=(s,...S)=>{var g;const T=h(s);try{if(X(r,s)){if(!Y(s))throw new Error("atom not writable");const N=T.n,w=S[0];G(s,w,h),W(s),N!==T.n&&(c.add(s),(g=f.c)==null||g.call(f,s),U(s));return}else return D(s,...S)}finally{l||(E(),y())}};try{return p(r,i,o,...u)}finally{l=!1}}),W=A[6]||(r=>{var u;const l=h(r),i=n.get(r);if(i&&!k(l.v)){for(const[o,s]of l.d)if(!i.d.has(o)){const S=h(o);z(o).t.add(r),i.d.add(o),s!==S.n&&(c.add(o),(u=f.c)==null||u.call(f,o),U(o))}for(const o of i.d||[])if(!l.d.has(o)){i.d.delete(o);const s=O(o);s==null||s.t.delete(r)}}}),z=A[7]||(r=>{var u;const l=h(r);let i=n.get(r);if(!i){R(r);for(const o of l.d.keys())z(o).t.add(r);if(i={l:new Set,d:new Set(l.d.keys()),t:new Set},n.set(r,i),(u=f.m)==null||u.call(f,r),C(r)){const o=()=>{let s=!0;const S=(...g)=>{try{return D(r,...g)}finally{s||(E(),y())}};try{const g=b(r,S);g&&(i.u=()=>{s=!0;try{g()}finally{s=!1}})}finally{s=!1}};v.add(o)}}return i}),O=A[8]||(r=>{var u;const l=h(r);let i=n.get(r);if(i&&!i.l.size&&!Array.from(i.t).some(o=>{var s;return(s=n.get(o))==null?void 0:s.d.has(r)})){i.u&&d.add(i.u),i=void 0,n.delete(r),(u=f.u)==null||u.call(f,r);for(const o of l.d.keys()){const s=O(o);s==null||s.t.delete(r)}return}return i}),se=[e,n,t,c,v,d,f,_,p,a,b,h,y,E,R,U,D,W,z,O],J={get:r=>x(R(r)),set:(r,...u)=>{try{return D(r,...u)}finally{E(),y()}},sub:(r,u)=>{const i=z(r).l;return i.add(u),y(),()=>{i.delete(u),O(r),y()}}};return Object.defineProperty(J,fe,{value:se}),J},te=ae,ve=de,H=m,F={};let he=0;function Te(e,n){const t=`atom${++he}`,c={toString(){return(F?"production":void 0)!=="production"&&this.debugLabel?t+":"+this.debugLabel:t}};return c.init=e,c.read=_e,c.write=we,c}function _e(e){return e(this)}function we(e,n,t){return n(this,typeof t=="function"?t(e(this)):t)}const Se=()=>{let e=0;const n=ve({}),t=new WeakMap,c=new WeakMap,v=te(t,c,void 0,void 0,void 0,void 0,n,void 0,(_,p,a,...b)=>e?a(_,...b):_.write(p,a,...b)),d=new Set;return n.m.add(void 0,_=>{d.add(_);const p=t.get(_);p.m=c.get(_)}),n.u.add(void 0,_=>{d.delete(_);const p=t.get(_);delete p.m}),Object.assign(v,{dev4_get_internal_weak_map:()=>t,dev4_get_mounted_atoms:()=>d,dev4_restore_atoms:_=>{const p={read:()=>null,write:(a,b)=>{++e;try{for(const[A,h]of _)"init"in A&&b(A,h)}finally{--e}}};v.set(p)}})};function ne(){return(F?"production":void 0)!=="production"?Se():te()}let I;function ye(){return I||(I=ne(),(F?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=I),globalThis.__JOTAI_DEFAULT_STORE__!==I&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),I}const ge={},re=P.createContext(void 0);function oe(e){return P.useContext(re)||ye()}function De({children:e,store:n}){const t=P.useRef(void 0);return!n&&!t.current&&(t.current=ne()),P.createElement(re.Provider,{value:n||t.current},e)}const ie=e=>typeof(e==null?void 0:e.then)=="function",pe=e=>{e.status="pending",e.then(n=>{e.status="fulfilled",e.value=n},n=>{e.status="rejected",e.reason=n})},be=ce.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(pe(e),e)}),q=new WeakMap,Ee=(e,n)=>{let t=q.get(e);return t||(t=new Promise((c,v)=>{let d=e;const f=a=>b=>{d===a&&c(b)},_=a=>b=>{d===a&&v(b)},p=()=>{try{const a=n();ie(a)?(q.set(a,t),d=a,a.then(f(a),_(a)),H(a,p)):c(a)}catch(a){v(a)}};e.then(f(e),_(e)),H(e,p)}),q.set(e,t)),t};function Ae(e,n){const t=oe(),[[c,v,d],f]=P.useReducer(a=>{const b=t.get(e);return Object.is(a[0],b)&&a[1]===t&&a[2]===e?a:[b,t,e]},void 0,()=>[t.get(e),t,e]);let _=c;if((v!==t||d!==e)&&(f(),_=t.get(e)),P.useEffect(()=>{const a=t.sub(e,()=>{f()});return f(),a},[t,e,void 0]),P.useDebugValue(_),ie(_)){const a=Ee(_,()=>t.get(e));return be(a)}return _}function Pe(e,n){const t=oe();return P.useCallback((...v)=>{if((ge?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return t.set(e,...v)},[t,e])}function Ie(e,n){return[Ae(e),Pe(e)]}export{De as P,Te as a,Ie as u};
